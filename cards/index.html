<!DOCTYPE html>
<!-- Example: ?David=10s,7c,8c,6c&Gretchen=5s,Ks,3h,5h&Jenny+(MS)=6d,Js,5h,Kc&Steve=8c,Kd,2c,10d&John=7d,3h,3c,10h&Jim=7d,As,4d,9h&Kate=4h,6d,8h,5c&Tom=As,4c,Joker,Qh&Josephine=Kh,Qd,10c,Joker&Tiffany=9h,3s,8s,4s&Jen+(CO)=8d,Jd,10h,9&Megan=9d,Jc,9s,Ah&Dan=Kd,2d,Ah,Jh -->
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="cards.css">
    <style>
        dl {
            display: grid;
            grid-template-columns: 10rem auto;
        }

        dt {
            font-weight: bold;
            margin: 0.25rem;
            z-index: 1;
        }

        dt > p {
            font-weight: normal;
            font-size: smaller;
        }

        dd {
            margin: 0.25rem;
            z-index: 1;
        }

@keyframes animate {
    0%{
        transform: translateY(0) rotate(0deg);
        opacity: 1;
        border-radius: 0;
    }
    100%{
        transform: translateY(-1000px) rotate(720deg);
        opacity: 0;
        border-radius: 50%;
    }
}

@keyframes animate2 {
    0%{
        transform: translateY(0) rotate(0deg);
        opacity: 1;
        border-radius: 30%;
    }
    100%{
        transform: translateY(-2000px) rotate(-720deg);
        opacity: 0;
        border-radius: 0%;
    }
}

@keyframes animate3 {
    0%{
        transform: translateY(0) rotate(0deg);
        opacity: 1;
        border-radius: 0;
    }
    100%{
        transform: translateY(-1500px) rotate(540deg) scale(1.5);
        opacity: 0;
        border-radius: 50%;
    }
}

@keyframes hilight {
    0%{
    }
    50%{
        text-shadow: 0 0 5px rgba(255, 255, 255, 0.5), 0 0 10px rgba(255, 255, 255, 0.3);
    }
    100% {

    }
}

@keyframes winner-winner-chicken-dinner {
    0%{
        text-shadow:
            0 0 4px #ff0000, /* Red */
            0 0 8px #ff7f00, /* Orange */
            0 0 12px #ffff00, /* Yellow */
            0 0 16px #00ff00, /* Green */
            0 0 20px #0000ff, /* Blue */
            0 0 24px #4b0082, /* Indigo */
            0 0 28px #9400d3; /* Violet */
    }
    14%{
        text-shadow:
            0 0 4px #9400d3, /* Violet */
            0 0 8px #ff0000, /* Red */
            0 0 12px #ff7f00, /* Orange */
            0 0 16px #ffff00, /* Yellow */
            0 0 20px #00ff00, /* Green */
            0 0 24px #0000ff, /* Blue */
            0 0 28px #4b0082; /* Indigo */
    }
    28% {
        text-shadow:
            0 0 4px #4b0082, /* Indigo */
            0 0 8px #9400d3, /* Violet */
            0 0 12px #ff0000, /* Red */
            0 0 16px #ff7f00, /* Orange */
            0 0 20px #ffff00, /* Yellow */
            0 0 24px #00ff00, /* Green */
            0 0 28px #0000ff; /* Blue */
    }
    42% {
        text-shadow:
            0 0 4px #0000ff, /* Blue */
            0 0 8px #4b0082, /* Indigo */
            0 0 12px #9400d3, /* Violet */
            0 0 16px #ff0000, /* Red */
            0 0 20px #ff7f00, /* Orange */
            0 0 24px #ffff00, /* Yellow */
            0 0 28px #00ff00; /* Green */
    }
    56% {
        text-shadow:
            0 0 4px #00ff00, /* Green */
            0 0 8px #0000ff, /* Blue */
            0 0 12px #4b0082, /* Indigo */
            0 0 16px #9400d3, /* Violet */
            0 0 20px #ff0000, /* Red */
            0 0 24px #ff7f00, /* Orange */
            0 0 28px #ffff00; /* Yellow */
    }
    70% {
        text-shadow:
            0 0 4px #ffff00, /* Yellow */
            0 0 8px #00ff00, /* Green */
            0 0 12px #0000ff, /* Blue */
            0 0 16px #4b0082, /* Indigo */
            0 0 20px #9400d3, /* Violet */
            0 0 24px #ff0000, /* Red */
            0 0 28px #ff7f00; /* Orange */
    }
    84% {
        text-shadow:
            0 0 4px #ff7f00, /* Orange */
            0 0 8px #ffff00, /* Yellow */
            0 0 12px #00ff00, /* Green */
            0 0 16px #0000ff, /* Blue */
            0 0 20px #4b0082, /* Indigo */
            0 0 24px #9400d3, /* Violet */
            0 0 28px #ff0000; /* Red */
    }
    100% {
        text-shadow:
            0 0 4px #ff0000, /* Red */
            0 0 8px #ff7f00, /* Orange */
            0 0 12px #ffff00, /* Yellow */
            0 0 16px #00ff00, /* Green */
            0 0 20px #0000ff, /* Blue */
            0 0 24px #4b0082, /* Indigo */
            0 0 28px #9400d3; /* Violet */
    }
}
.place-7-0 {
    text-shadow:
            0 0 4px #ff0000, /* Red */
            0 0 8px #ff7f00, /* Orange */
            0 0 12px #ffff00, /* Yellow */
            0 0 16px #00ff00, /* Green */
            0 0 20px #0000ff, /* Blue */
            0 0 24px #4b0082, /* Indigo */
            0 0 28px #9400d3; /* Violet */
    font-weight: bold;
    color: #fff; /* Main text color */
    animation: winner-winner-chicken-dinner 3s linear infinite;
}

.steve {
    animation: hilight 5s linear infinite;
}

.background {
    position: fixed;
    width: 100vw;
    height: 100vh;
    top: 0;
    left: 0;
    margin: 0;
    padding: 0;
    background:
        linear-gradient(45deg, #2b6874 45px, transparent 45px)64px 64px,
        linear-gradient(45deg, #2b6874 45px, transparent 45px,transparent 91px, #20545e 91px, #20545e 135px, transparent 135px),
        linear-gradient(-45deg, #2b6874 23px, transparent 23px, transparent 68px,#2b6874 68px,#2b6874 113px,transparent 113px,transparent 158px,#2b6874 158px);
    background-color:#20545e;
    background-size: 128px 128px;
    overflow: hidden;
}
.background li {
    position: absolute;
    display: block;
    list-style: none;
    width: 20px;
    height: 20px;
    color:aliceblue;
    font-weight: 400%;
    font-size: x-large;
    background: rgba(255, 255, 255, 0.2);
    animation: animate 60s linear infinite;
}

.background li:nth-child(0) {
    left: 67%;
    width: 440px;
    height: 440px;
    bottom: -440px;
    animation-delay: 1s;
}
.background li:nth-child(1) {
    left: 31%;
    width: 433px;
    height: 433px;
    bottom: -433px;
    animation-delay: 7s;
    animation: animate2 60s linear infinite;
}
.background li:nth-child(2) {
    left: 63%;
    width: 397px;
    height: 397px;
    bottom: -397px;
    animation-delay: 15s;
    animation: animate3 60s linear infinite;
}
.background li:nth-child(3) {
    left: 26%;
    width: 486px;
    height: 486px;
    bottom: -486px;
    animation-delay: 20s;
    animation: animate2 120s linear infinite;
}
    </style>
</head>

<body>
    <dl id="players">

    </dl>
    <div >
<ul class="background">
   <li></li>
   <li></li>
   <li></li>
   <li></li>
</ul>
    <script type="module" src="./card_analyzer.js"> </script>
    <script type="module">
        import evaluateHand from "./card_analyzer.js";
        import renderCard from "./cards.js";
        const suits = {
            H: "Hearts",
            C: "Clubs",
            S: "Spades",
            D: "Diamonds"
        };
        const ranks = {
            A: "Ace",
            K: "King",
            Q: "Queen",
            J: "Jack",
            T: "10"
        };

        function forAnalysis(card) {
            if(card === "JOKER") return "JK";
            if(card.slice(0, -1) === "10") return 'T' + card.at(-1);
            return card;
        }

        function describeCard(card) {
            if(card==="JK") return "Joker";
            return `${describeRank(card[0])} of ${suits[card[1]]}`;
        }

        function describeRank(rank) {
            return ranks[rank] || rank;
        }

        function renderAnalysis({category, rank, highCard, kicker, kickers, suit, topPair, secondPair}) {
            switch(category) {
                case "Five of a Kind": case "Four of a Kind": case "Three of a Kind": return `${category} - ${describeRank(rank)}s`;
                case "Full House": return "Full House"
                case "Pair": return `Pair of ${describeRank(rank)}s`;
                case "Two Pair": return `Pairs of ${describeRank(topPair)}s and ${describeRank(secondPair)}s`;
                case "Straight": return `${category} - high of ${describeRank(highCard)}`;
                case "High Card": return `${describeRank(highCard)}-${(kickers||[]).slice(0,1).map(describeRank)} high`;
                case "Royal Flush": case "Flush": return `${category} - ${suits[suit]}`;
                default: console.log("Uhandled Possibility", {category, rank, highCard, kicker, kickers, suit});
            }
        }

        function renderPlayer({ player, cards, analysis }, index) {
            return `
                <dt class="${player.toLowerCase()} place-${cards.length}-${index}">${index+1}. ${player}<p>${renderAnalysis(analysis)}</p></dt>
                <dd>${cards.map(renderCard).join("")}</dd>
            `;
        }

        function normaliseCards(cardsStr) {
            return cardsStr.toUpperCase().split(',').map(str => str.trim());
        }

        let params = new URLSearchParams(window.location.search);
        
        let players = [
            ...params.entries()
                .map(([player, cardsStr]) => {
                    let cards = normaliseCards(cardsStr);

                    console.log(`Evaluating: ${player}`);
                    let analysis = evaluateHand(cards.map(forAnalysis));
                    console.log("analysis", analysis);
                    
                    return { player, cards, analysis};
                })
        ]

        document.querySelector("#players").innerHTML = players
            .toSorted((a,b) => (b?.analysis?.priority || 0) - (a?.analysis?.priority || 0))
            .map(renderPlayer).join("");
    </script>
</body>

</html>