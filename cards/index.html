<!DOCTYPE html>
<!-- Example: ?David=10s,7c,8c,6c&Gretchen=5s,Ks,3h,5h&Jenny+(MS)=6d,Js,5h,Kc&Steve=8c,Kd,2c,10d&John=7d,3h,3c,10h&Jim=7d,As,4d,9h&Kate=4h,6d,8h,5c&Tom=As,4c,Joker,Qh&Josephine=Kh,Qd,10c,Joker&Tiffany=9h,3s,8s,4s&Jen+(CO)=8d,Jd,10h,9&Megan=9d,Jc,9s,Ah&Dan=Kd,2d,Ah,Jh -->
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        dl {
            display: grid;
            grid-template-columns: 10rem auto;
        }

        dt {
            font-weight: bold;
            margin: 0.25rem;
            z-index: 1;
        }

        dt > p {
            font-weight: normal;
            font-size: smaller;
        }

        dd {
            margin: 0.25rem;
            z-index: 1;
        }

        .card {
            display: inline-block;
            position: relative;
            width: 90px;
            height: 126px;
            background-color: #ffffff;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
            z-index: 1;
        }

        .card-corner {
            position: absolute;
            font-size: 16px;
            line-height: 1em;
            text-align: center;
        }

        .card-corner.top-left {
            top: 5px;
            left: 3px;
        }

        .card-corner.bottom-right {
            bottom: 5px;
            right: 3px;
            transform: rotate(180deg);
        }

        .card.red {
            color: red;
        }

        .card.black {
            color: black;
        }

        /* Pips should be absolutely positioned within the card container */
        .pip {
            position: absolute;
            font-size: 28px;
            line-height: 1em;
            transform: translate(-50%, -50%);
        }

        .rank-a .pip,
        .rank-j .pip,
        .rank-q .pip,
        .rank-k .pip,
        .rank-joker .pip {
            top: 50%;
            left: 50%;
            font-size: 72px;
            transform: translate(-50%, -43%);
        }

        .rank-2 .pip:nth-child(1) {
            top: 20%;
            left: 50%;
        }

        .rank-2 .pip:nth-child(2) {
            top: 80%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(180deg);
        }

        .rank-3 .pip:nth-child(1) {
            top: 20%;
            left: 50%;
        }

        .rank-3 .pip:nth-child(2) {
            top: 50%;
            left: 50%;
        }

        .rank-3 .pip:nth-child(3) {
            top: 80%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(180deg);
        }

        .rank-4 .pip:nth-child(1) {
            top: 20%;
            left: 30%;
        }

        .rank-4 .pip:nth-child(2) {
            top: 20%;
            left: 70%;
        }

        .rank-4 .pip:nth-child(3) {
            top: 80%;
            left: 30%;
            transform: translate(-50%, -50%) rotate(180deg);
        }

        .rank-4 .pip:nth-child(4) {
            top: 80%;
            left: 70%;
            transform: translate(-50%, -50%) rotate(180deg);
        }

        .rank-5 .pip:nth-child(1) {
            top: 20%;
            left: 30%;
        }

        .rank-5 .pip:nth-child(2) {
            top: 20%;
            left: 70%;
        }

        .rank-5 .pip:nth-child(3) {
            top: 50%;
            left: 50%;
        }

        .rank-5 .pip:nth-child(4) {
            top: 80%;
            left: 30%;
            transform: translate(-50%, -50%) rotate(180deg);
        }

        .rank-5 .pip:nth-child(5) {
            top: 80%;
            left: 70%;
            transform: translate(-50%, -50%) rotate(180deg);
        }

        .rank-6 .pip:nth-child(1) {
            top: 20%;
            left: 30%;
        }

        .rank-6 .pip:nth-child(2) {
            top: 50%;
            left: 30%;
        }

        .rank-6 .pip:nth-child(3) {
            top: 80%;
            left: 30%;
            transform: translate(-50%, -50%) rotate(180deg);
        }

        .rank-6 .pip:nth-child(4) {
            top: 20%;
            left: 70%;
        }

        .rank-6 .pip:nth-child(5) {
            top: 50%;
            left: 70%;
        }

        .rank-6 .pip:nth-child(6) {
            top: 80%;
            left: 70%;
            transform: translate(-50%, -50%) rotate(180deg);
        }

        .rank-7 .pip:nth-child(1) {
            top: 20%;
            left: 30%;
        }

        .rank-7 .pip:nth-child(2) {
            top: 50%;
            left: 30%;
        }

        .rank-7 .pip:nth-child(3) {
            top: 80%;
            left: 30%;
            transform: translate(-50%, -50%) rotate(180deg);
        }

        .rank-7 .pip:nth-child(4) {
            top: 20%;
            left: 70%;
        }

        .rank-7 .pip:nth-child(5) {
            top: 50%;
            left: 70%;
        }

        .rank-7 .pip:nth-child(6) {
            top: 80%;
            left: 70%;
            transform: translate(-50%, -50%) rotate(180deg);
        }

        .rank-7 .pip:nth-child(7) {
            top: 35%;
            left: 50%;
        }

        .rank-8 .pip:nth-child(1) {
            top: 20%;
            left: 30%;
        }

        .rank-8 .pip:nth-child(2) {
            top: 50%;
            left: 30%;
        }

        .rank-8 .pip:nth-child(3) {
            top: 80%;
            left: 30%;
            transform: translate(-50%, -50%) rotate(180deg);
        }

        .rank-8 .pip:nth-child(4) {
            top: 20%;
            left: 70%;
        }

        .rank-8 .pip:nth-child(5) {
            top: 50%;
            left: 70%;
        }

        .rank-8 .pip:nth-child(6) {
            top: 80%;
            left: 70%;
            transform: translate(-50%, -50%) rotate(180deg);
        }

        .rank-8 .pip:nth-child(7) {
            top: 35%;
            left: 50%;
        }

        .rank-8 .pip:nth-child(8) {
            top: 65%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(180deg);
        }

        /* Extra bottom middle, adjusted */

        .rank-9 .pip:nth-child(1) {
            top: 20%;
            left: 30%;
        }

        .rank-9 .pip:nth-child(2) {
            top: 40%;
            left: 30%;
        }

        .rank-9 .pip:nth-child(3) {
            top: 60%;
            left: 30%;
            transform: translate(-50%, -50%) rotate(180deg);
        }

        .rank-9 .pip:nth-child(4) {
            top: 80%;
            left: 30%;
            transform: translate(-50%, -50%) rotate(180deg);
        }

        .rank-9 .pip:nth-child(5) {
            top: 20%;
            left: 70%;
        }

        .rank-9 .pip:nth-child(6) {
            top: 40%;
            left: 70%;
        }

        .rank-9 .pip:nth-child(7) {
            top: 60%;
            left: 70%;
            transform: translate(-50%, -50%) rotate(180deg);
        }

        .rank-9 .pip:nth-child(8) {
            top: 80%;
            left: 70%;
            transform: translate(-50%, -50%) rotate(180deg);
        }

        .rank-9 .pip:nth-child(9) {
            top: 50%;
            left: 50%;
        }

        .rank-10 .pip:nth-child(1) {
            top: 20%;
            left: 30%;
        }

        .rank-10 .pip:nth-child(2) {
            top: 40%;
            left: 30%;
        }

        .rank-10 .pip:nth-child(3) {
            top: 60%;
            left: 30%;
            transform: translate(-50%, -50%) rotate(180deg);
        }

        .rank-10 .pip:nth-child(4) {
            top: 80%;
            left: 30%;
            transform: translate(-50%, -50%) rotate(180deg);
        }

        .rank-10 .pip:nth-child(5) {
            top: 20%;
            left: 70%;
        }

        .rank-10 .pip:nth-child(6) {
            top: 40%;
            left: 70%;
        }

        .rank-10 .pip:nth-child(7) {
            top: 60%;
            left: 70%;
            transform: translate(-50%, -50%) rotate(180deg);
        }

        .rank-10 .pip:nth-child(8) {
            top: 80%;
            left: 70%;
            transform: translate(-50%, -50%) rotate(180deg);
        }

        .rank-10 .pip:nth-child(9) {
            top: 30%;
            left: 50%;
        }

        .rank-10 .pip:nth-child(10) {
            top: 70%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(180deg);
        }
    </style>
    <style>
@keyframes animate {
    0%{
        transform: translateY(0) rotate(0deg);
        opacity: 1;
        border-radius: 0;
    }
    100%{
        transform: translateY(-1000px) rotate(720deg);
        opacity: 0;
        border-radius: 50%;
    }
}

@keyframes animate2 {
    0%{
        transform: translateY(0) rotate(0deg);
        opacity: 1;
        border-radius: 30%;
    }
    100%{
        transform: translateY(-2000px) rotate(-720deg);
        opacity: 0;
        border-radius: 0%;
    }
}

@keyframes animate3 {
    0%{
        transform: translateY(0) rotate(0deg);
        opacity: 1;
        border-radius: 0;
    }
    100%{
        transform: translateY(-1500px) rotate(540deg) scale(1.5);
        opacity: 0;
        border-radius: 50%;
    }
}

@keyframes hilight {
    0%{
    }
    50%{
        text-shadow: 0 0 5px rgba(255, 255, 255, 0.5), 0 0 10px rgba(255, 255, 255, 0.3);
    }
    100% {

    }
}

.steve {
    animation: hilight 5s linear infinite;
}

.background {
    position: fixed;
    width: 100vw;
    height: 100vh;
    top: 0;
    left: 0;
    margin: 0;
    padding: 0;
    background:
        linear-gradient(45deg, #2b6874 45px, transparent 45px)64px 64px,
        linear-gradient(45deg, #2b6874 45px, transparent 45px,transparent 91px, #20545e 91px, #20545e 135px, transparent 135px),
        linear-gradient(-45deg, #2b6874 23px, transparent 23px, transparent 68px,#2b6874 68px,#2b6874 113px,transparent 113px,transparent 158px,#2b6874 158px);
    background-color:#20545e;
    background-size: 128px 128px;
    overflow: hidden;
}
.background li {
    position: absolute;
    display: block;
    list-style: none;
    width: 20px;
    height: 20px;
    color:aliceblue;
    font-weight: 400%;
    font-size: x-large;
    background: rgba(255, 255, 255, 0.2);
    animation: animate 60s linear infinite;
}

.background li:nth-child(0) {
    left: 67%;
    width: 440px;
    height: 440px;
    bottom: -440px;
    animation-delay: 1s;
}
.background li:nth-child(1) {
    left: 31%;
    width: 433px;
    height: 433px;
    bottom: -433px;
    animation-delay: 7s;
    animation: animate2 60s linear infinite;
}
.background li:nth-child(2) {
    left: 63%;
    width: 397px;
    height: 397px;
    bottom: -397px;
    animation-delay: 15s;
    animation: animate3 60s linear infinite;
}
.background li:nth-child(3) {
    left: 26%;
    width: 486px;
    height: 486px;
    bottom: -486px;
    animation-delay: 20s;
    animation: animate2 120s linear infinite;
}
    </style>
</head>

<body>
    <dl id="players">

    </dl>
    <div >
<ul class="background">
   <li></li>
   <li></li>
   <li></li>
   <li></li>
</ul>
    <script type="module" src="./card_analyzer.js"> </script>
    <script type="module">
        import evaluateHand from "./card_analyzer.js"

        const suitRenderDetails = {
            S: { value: '♠', color: 'black' },
            H: { value: '♥', color: 'red' },
            D: { value: '♦', color: 'red' },
            C: { value: '♣', color: 'black' },
            none: { value: '', color: '', joker: true }
        };
        const suits = {
            H: "Hearts",
            C: "Clubs",
            S: "Spades",
            D: "Diamonds"
        };
        const ranks = {
            A: "Ace",
            K: "King",
            Q: "Queen",
            J: "Jack",
            T: "10"
        };

        function renderPips(rank, suit) {
            if (['J', 'Q', 'K', 'Joker'].includes(rank)) {
                return `<div class="pip"><img src="${rank}${suit}.svg" width=70 /></div>`;
            }
            let count = (rank === 'A') ? 1 : parseInt(rank, 10)
            return `<div class="pip">${suit}</div>`.repeat(count);
        }

        function renderPlayer({ player, cards, analysis }) {
            return `
                <dt class="${player.toLowerCase()}">${player}<p>${renderAnalysis(analysis)}</p></dt>
                <dd>${cards.map(renderCard).join("")}</dd>
            `;
        }

        function renderCard(card) {
            let suit = suitRenderDetails[card.at(-1)] || suitRenderDetails.none;
            let rank = suit.joker ? "Joker" : card.slice(0, -1);

            return `
            <div class="card ${suit.color} rank-${rank.toLowerCase()}">
                <div class="card-corner top-left">${rank}<br/>${suit.value}</div>
                <div class="card-middle">${renderPips(rank, suit.value)}</div>
                <div class="card-corner bottom-right">${rank}<br/>${suit.value}</div>
            </div>`;
        }

        function forAnalysis(card) {
            if(card === "JOKER") return "JK";
            if(card.slice(0, -1) === "10") return 'T' + card.at(-1);
            return card;
        }

        function describeCard(card) {
            if(card==="JK") return "Joker";
            return `${describeRank(card[0])} of ${suits[card[1]]}`;
        }

        function describeRank(rank) {
            return ranks[rank] || rank;
        }

        function renderAnalysis({category, rank, highCard, kicker, kickers, suit, topPair, secondPair}) {
            switch(category) {
                case "Five of a Kind": case "Four of a Kind": case "Three of a Kind": return `${category} - ${describeRank(rank)}s`;
                case "Full House": return "Full House"
                case "Pair": return `Pair of ${describeRank(rank)}s`;
                case "Two Pair": return `Pairs of ${describeRank(topPair)}s and ${describeRank(secondPair)}s`;
                case "Straight": return `${category} - high of ${describeRank(highCard)}`;
                case "High Card": return `${describeRank(highCard)}-${(kickers||[]).slice(0,1).map(describeRank)} high`;
                case "Royal Flush": case "Flush": return `${category} - ${suits[suit]}`;
                default: console.log("Uhandled Possibility", {category, rank, highCard, kicker, kickers, suit});
            }
        }

        function normaliseCards(cardsStr) {
            return cardsStr.toUpperCase().split(',').map(str => str.trim());
        }

        let params = new URLSearchParams(window.location.search);
        
        let players = [
            ...params.entries()
                .map(([player, cardsStr]) => {
                    let cards = normaliseCards(cardsStr);
                    return { player, cards };
                })
        ]

        document.querySelector("#players").innerHTML = players.map( ({player, cards}) => {
            console.log(`Evaluating: ${player}`);
            let analysis = evaluateHand(cards.map(forAnalysis));
            console.log("analysis", analysis);
            return { player, cards, analysis };
        }).map(renderPlayer).join("");
    </script>
</body>

</html>